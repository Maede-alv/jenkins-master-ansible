jenkins:
  systemMessage: "Jenkins Configured via Ansible and JCasC"
  numExecutors: 2
  mode: EXCLUSIVE
  slaveAgentPort: 50000
  disableRememberMe: false
  crumbIssuer:
    standard:
      excludeClientIPFromCrumb: false
  securityRealm:
    local:
      allowsSignup: false
      users:
        - id: "{{ jenkins_admin_username }}"
          password: "{{ jenkins_admin_password }}"
  authorizationStrategy:
    loggedInUsersCanDoAnything:
      allowAnonymousRead: false

credentials:
  system:
    domainCredentials:
      - credentials:
          - usernamePassword:
              scope: GLOBAL
              id: "git-token"
              username: "{{ github_username }}"
              password: "{{ github_token }}"

tool:
  git:
    installations:
      - name: "Default"
        home: "/usr/bin/git"
  maven:
    installations:
      - name: "maven3"
        properties:
          - installSource:
              installers:
                - maven:
                    id: "3.8.4"

unclassified:
  githubPluginConfig:
    configs:
      - name: "GitHub"
        apiUrl: "https://api.github.com/"
        credentialsId: "git-token"
        manageHooks: true

jobs:
  - script: >
      pipelineJob('seed-job') {
        description('This job loads Job DSL scripts from GitHub repo')
        definition {
          cps {
            script("""
              pipeline {
                agent any
                stages {
                  stage('Checkout DSL Scripts') {
                    steps {
                      git(
                        url: "{{ jobdsl_repo_url }}",
                        credentialsId: 'git-token',
                        branch: 'main'
                      )
                      jobDsl(
                        targets: 'jobs/*.groovy',
                        removedJobAction: 'DELETE',
                        removedViewAction: 'DELETE'
                      )
                    }
                  }
                }
              }
            """.stripIndent())
            sandbox()
          }
        }
      }
